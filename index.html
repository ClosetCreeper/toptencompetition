<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Top 10 Leaderboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .leaderboard {
      max-width: 600px;
      margin: 0 auto;
    }
    .entry {
      display: flex;
      align-items: center;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 10px;
      margin-bottom: 10px;
    }
    .entry img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 15px;
      object-fit: cover;
    }
    .entry .name {
      font-weight: bold;
      flex: 1;
    }
    .entry .score {
      font-size: 18px;
      color: #28a745;
    }
  </style>
</head>
<body>
  <h1>üì∏ Top 10 Leaderboard</h1>
  <div class="leaderboard" id="leaderboard">Loading...</div>

  <!-- CloudKit JS -->
  <script src="https://cdn.apple-cloudkit.com/ck/2/cloudkit.js"></script>
  <script>
    CloudKit.configure({
      containers: [{
        containerIdentifier: 'iCloud.keyninestudios.topten',
        apiTokenAuth: {
          apiToken: '346a7cfef02d0ca86c0f4d45b6c82c8c810000386287ac8cd9618680d6a001a1'
        },
        environment: 'production'
      }]
    });

    const db = CloudKit.getDefaultContainer().publicCloudDatabase;

    // Hardcoded users with display name and recordName
    const users = [
      { name: "Kehoe", id: "user_8017078254", profilePic: "https://example.com/alice.jpg" },
      { name: "Mark", id: "user_7035894154", profilePic: "https://example.com/bob.jpg" },
      { name: "Sam", id: "user_5032904959", profilePic: "https://example.com/charlie.jpg" }
    ];

    async function buildLeaderboard() {
      const leaderboardDiv = document.getElementById("leaderboard");
      leaderboardDiv.innerHTML = "Loading...";

      try {
        const results = [];

        for (let user of users) {
          const photoRes = await db.performQuery({
            recordType: "Top10PhotoEntries",
            filterBy: [{
              fieldName: "user",
              comparator: "EQUALS",
              fieldValue: { value: { recordName: user.id, type: "REFERENCE" } }
            }]
          });

          const score = photoRes.records.length * 3;
          results.push({
            username: user.name,
            profilePic: user.profilePic,
            score
          });
        }

        // Sort by score descending
        results.sort((a, b) => b.score - a.score);

        leaderboardDiv.innerHTML = "";
        results.forEach((entry, i) => {
          const div = document.createElement("div");
          div.className = "entry";
          div.innerHTML = `
            <img src="${entry.profilePic}" alt="Profile picture">
            <div class="name">${i+1}. ${entry.username}</div>
            <div class="score">${entry.score}</div>
          `;
          leaderboardDiv.appendChild(div);
        });

      } catch (err) {
        console.error("Error loading leaderboard:", err);
        leaderboardDiv.innerHTML = "‚ö†Ô∏è Failed to load leaderboard.";
      }
    }

    buildLeaderboard();
  </script>
</body>
</html>
